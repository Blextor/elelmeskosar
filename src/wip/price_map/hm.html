<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Üzletek térképe – értékekkel</title>

  <!-- Leaflet CSS/JS (CDN) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100vh; width: 100vw; }

    /* Tooltip olvashatóbbá tétele */
    .leaflet-tooltip {
      background: white;
      border: 1px solid #ddd;
      box-shadow: 0 2px 8px rgba(0,0,0,.15);
      padding: .35rem .5rem;
      font: 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* Egyszerű jelmagyarázat */
    .legend {
      position: absolute;
      bottom: 14px;
      left: 12px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px 12px;
      font: 12px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      box-shadow: 0 2px 10px rgba(0,0,0,.1);
    }
    .legend-row { display: flex; align-items: center; gap: 6px; margin: 4px 0; }
    .legend-swatch { width: 14px; height: 14px; border-radius: 50%; border: 1px solid rgba(0,0,0,.25); }
  </style>
</head>
<body>
  <div id="map" role="region" aria-label="Üzletek térképe"></div>
  <div class="legend" id="legend">
    <div><strong>Érték szerinti jelölés</strong></div>
    <!-- kitöltjük JS-ből a valós skálával -->
  </div>

  <script>
    // 1) IDE ADD AZ ADATAIDAT:
    // lat/lng: WGS84 fokok (pl. Google Maps 'What's here?' vagy OpenStreetMap koordináták)
    const storeData = [
      { name: "Sarki ABC",        value: 12, lat: 47.4979, lng: 19.0402 }, // Budapest
      { name: "Helyi Piac",       value: 35, lat: 46.2530, lng: 20.1414 }, // Szeged
      { name: "FrissFood Szolnok",value: 22, lat: 47.1747, lng: 20.1943 },
      { name: "BioBolt Győr",     value: 48, lat: 47.6875, lng: 17.6504 },
      { name: "Gazda Kft. Debrecen", value: 8, lat: 47.5316, lng: 21.6273 }
    ];

    // Ha az értéktartományt ismered, itt megadhatod kézzel:
    const VALUE_MIN = Math.min(...storeData.map(d => d.value));
    const VALUE_MAX = Math.max(...storeData.map(d => d.value));

    // 2) TÉRKÉP LÉTREHOZÁSA
    const map = L.map('map', { scrollWheelZoom: true }).setView([47.1625, 19.5033], 7); // Magyarország közepe
    L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> közreműködők'
      }
    ).addTo(map);

    // 3) SZÍN ÉS MÉRET SKÁLÁK (érték alapján)
    function lerp(a, b, t) { return a + (b - a) * t; }
    function clamp(x, lo, hi) { return Math.max(lo, Math.min(hi, x)); }

    // Egyszerű kék→narancs színskála (alacsony→magas)
    function colorForValue(v) {
      const t = VALUE_MAX === VALUE_MIN ? 0.5 : (v - VALUE_MIN) / (VALUE_MAX - VALUE_MIN);
      // Interpoláljunk #3B82F6 (kék) → #F59E0B (narancs)
      const c1 = { r: 59,  g: 130, b: 246 }; // kék
      const c2 = { r: 245, g: 158, b: 11  }; // narancs
      const r = Math.round(lerp(c1.r, c2.r, t));
      const g = Math.round(lerp(c1.g, c2.g, t));
      const b = Math.round(lerp(c1.b, c2.b, t));
      return `rgb(${r}, ${g}, ${b})`;
    }

    // Kör sugara pixelben (6–16 px)
    function radiusForValue(v) {
      const t = VALUE_MAX === VALUE_MIN ? 0.5 : (v - VALUE_MIN) / (VALUE_MAX - VALUE_MIN);
      return lerp(6, 16, clamp(t, 0, 1));
    }

    // 4) MARKEREK + HOVER TOOLTIPEK
    const layerGroup = L.layerGroup().addTo(map);

    storeData.forEach(d => {
      const marker = L.circleMarker([d.lat, d.lng], {
        radius: radiusForValue(d.value),
        color: '#00000055',      // kontúr
        weight: 1,
        fillColor: colorForValue(d.value),
        fillOpacity: 0.85
      }).addTo(layerGroup);

      // Tooltip alapból hoverre jelenik meg
      marker.bindTooltip(
        `<strong>${escapeHtml(d.name)}</strong><br/>Érték: <strong>${d.value}</strong>`,
        { direction: 'top', offset: [0, -2], sticky: true }
      );

      // Kis hover anim: nagyobb sugár, erősebb kontúr
      marker.on('mouseover', () => {
        marker.setStyle({ weight: 2, fillOpacity: 1.0, radius: radiusForValue(d.value) + 2 });
      });
      marker.on('mouseout', () => {
        marker.setStyle({ weight: 1, fillOpacity: 0.85, radius: radiusForValue(d.value) });
      });
    });

    // 5) JELMAGYARÁZAT (3 pont mintavétellel)
    const legend = document.getElementById('legend');
    const ticks = [
      { label: 'alacsony', v: VALUE_MIN },
      { label: 'közepes', v: Math.round((VALUE_MIN + VALUE_MAX) / 2) },
      { label: 'magas',   v: VALUE_MAX }
    ];
    ticks.forEach(t => {
      const row = document.createElement('div');
      row.className = 'legend-row';
      row.innerHTML = `
        <span class="legend-swatch" style="background:${colorForValue(t.v)}"></span>
        <span>${t.label}: <strong>${t.v}</strong></span>
      `;
      legend.appendChild(row);
    });

    // 6) Biztonsági HTML-escape a tooltiphez
    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }

    // 7) (Opcionális) automatikus ránagyítás, hogy minden pont látszódjon
    if (storeData.length > 0) {
      const bounds = L.latLngBounds(storeData.map(d => [d.lat, d.lng]));
      map.fitBounds(bounds.pad(0.1));
    }
  </script>
</body>
</html>
